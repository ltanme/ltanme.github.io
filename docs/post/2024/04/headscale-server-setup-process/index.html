<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Server setup process using Headscale with Docker. :: LTAN.ME</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Server setup process using Headscale with Docker. 记录采用headscale &amp;amp; docker 异地组网过程 需求背景 曾经我尝试使用ZeroTier，最初的体验非常不错。然而，随着时间的推移，我发现连接速度变得缓慢和卡顿， 有时甚至需要借助特殊的网络加速技" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://ltan.me/post/2024/04/headscale-server-setup-process/" />




<link rel="stylesheet" href="https://ltan.me/assets/style.css">






<link rel="apple-touch-icon" href="https://ltan.me/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://ltan.me/img/favicon/orange.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Server setup process using Headscale with Docker.">
<meta property="og:description" content="Server setup process using Headscale with Docker. 记录采用headscale &amp;amp; docker 异地组网过程 需求背景 曾经我尝试使用ZeroTier，最初的体验非常不错。然而，随着时间的推移，我发现连接速度变得缓慢和卡顿， 有时甚至需要借助特殊的网络加速技" />
<meta property="og:url" content="https://ltan.me/post/2024/04/headscale-server-setup-process/" />
<meta property="og:site_name" content="LTAN.ME" />

  
    <meta property="og:image" content="https://ltan.me/img/favicon/orange.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2024-04-15 21:21:29 &#43;0800 CST" />












</head>
<body class="orange">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    LTAN.ME
  </div>
</a>

    </div>
    
    <div class="menu-trigger">menu</div>
    
  </div>
  
  <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">Home</a></li>
        
      
        
          <li><a href="/post/">Archives</a></li>
        
      
        
          <li><a href="/tags/">Tags</a></li>
        
      
        
          <li><a href="/about/">About</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">Home</a></li>
      
    
      
        <li><a href="/post/">Archives</a></li>
      
    
      
        <li><a href="/tags/">Tags</a></li>
      
    
      
        <li><a href="/about/">About</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://ltan.me/post/2024/04/headscale-server-setup-process/">Server setup process using Headscale with Docker.</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2024-04-15 [Mod: 2024-04-15]
      </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://ltan.me/tags/tailscale/">tailscale</a>&nbsp;
    
    #<a href="https://ltan.me/tags/headscale/">headscale</a>&nbsp;
    
    #<a href="https://ltan.me/tags/docker/">docker</a>&nbsp;
    
  </span>
  

  

  

  <div class="post-content"><div>
        <h1 id="server-setup-process-using-headscale-with-docker">Server setup process using Headscale with Docker.<a href="#server-setup-process-using-headscale-with-docker" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h2 id="记录采用headscale--docker-异地组网过程">记录采用headscale &amp; docker 异地组网过程<a href="#记录采用headscale--docker-异地组网过程" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h2 id="需求背景">需求背景<a href="#需求背景" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>曾经我尝试使用<code>ZeroTier</code>，最初的体验非常不错。然而，随着时间的推移，我发现连接速度变得缓慢和卡顿，
有时甚至需要借助特殊的网络加速技术来提高性能。后来，在<code>X</code>社区中，我看到有人分享了<code>Tailscale</code>的好评，
这促使我安装了<code>Tailscale</code>的官方客户端。相较于<code>ZeroTier</code>，<code>Tailscale</code>在速度上有显著的提升，
尽管偶尔也会遇到一些延迟。<code>Tailscale</code>依赖于其官方服务器，但它支持用户自建服务器，
这一点非常吸引我。通过结合使用<code>Tailscale</code>客户端和官网，我们可以实现异地组网。
为了达到更理想的连接速度，我决定自建异地组网系统。这样不仅能控制家中的<code>群晖</code>设备，还能优化<code>PT</code>下载等功能。</p>
</blockquote>
<h2 id="搭建headscale服务端">搭建<code>headscale</code>服务端<a href="#搭建headscale服务端" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>1,准备环境<code>linux(centos7/ubuntu)</code><br>
2,安装<code>docker</code>,<br>
3,申请好域名,准备<code>https</code>证书 推荐<code>cf</code>,并解析到自己的服务器<br>
<code>ssl_certificate</code> 和 <code>ssl_certificate_key</code> 为自己申请的域名证书从cf导出来的文件<br>
4,安装好<code>nginx</code>,<code>nginx</code>配置如下,打码地方为自己的域名，箭头处需要开启<code>websocket</code><br>
<img src="img.png" alt="img.png"></p>
</blockquote>
<h3 id="准备headscale-配置文件">准备<code>headscale</code> 配置文件<a href="#准备headscale-配置文件" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>创建目录</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mkdir -p /root/mydocker/config
chmod -R a+x /root/mydocker/config
</code></pre></div><blockquote>
<p>从以下链接地址下载配置文件</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">wget -O /root/mydocker/conf/config.yaml https://raw.githubusercontent.com/juanfont/headscale/main/config-example.yaml
</code></pre></div><blockquote>
<p>修改配置文件<code>config.yaml</code> 文件</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> server_url: https://你的域名:443
 listen_addr: 0.0.0.0:8080
 metrics_listen_addr: 0.0.0.0:9090
 noise:
    private_key_path: /etc/headscale/noise_private.key
 database:
  type: sqlite3
  sqlite:
    path: /etc/headscale/db.sqlite
</code></pre></div><h2 id="部署headscale">部署headscale<a href="#部署headscale" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>启动docker, 我是在/root/mydocker/ 目录启动的</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  docker run --name headscale --detach --volume <span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span>/config:/etc/headscale/ --publish 0.0.0.0:8080:8080 --publish 0.0.0.0:9090:9090 headscale/headscale:0.23.0-alpha5 serve
</code></pre></div><h2 id="在windows或客户端安装tailscale官网下载并安装好">在windows或客户端安装tailscale(官网下载并安装好)<a href="#在windows或客户端安装tailscale官网下载并安装好" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>以win10 为例 直接采用命令行登录<br>
<img src="img_1.png" alt="img_1.png"><br>
会得到以下地址:<br>
https://你的域名:443/register/mkey:23234kflasdjf&hellip;..
mkey 后面请复制一下
进入到headscale 服务器命令行，执行以下命令，将<code>23234kflasdjf.....</code> 注册即可</p>
</blockquote>
<h2 id="进入服务器执行命令注册登录的设备">进入服务器,执行命令注册登录的设备<a href="#进入服务器执行命令注册登录的设备" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>执行以下命令，因为是docker安装的<br>
mywin10 就表示对应需要组网的机器</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker exec headscale headscale users create mywin10
docker exec headscale headscale nodes register --user admin --key mkey:23234kflasdjf.....
</code></pre></div><blockquote>
<p>以下是我执行的上面两条docker命令的示例</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@racknerd-6d4dab3 ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec headscale headscale users create admin</span>
2024-04-08T12:28:08Z TRC DNS configuration loaded dns_config<span style="color:#f92672">={</span><span style="color:#e6db74">&#34;Nameservers&#34;</span>:<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;1.1.1.1&#34;</span><span style="color:#f92672">]</span>,<span style="color:#e6db74">&#34;Proxied&#34;</span>:true,<span style="color:#e6db74">&#34;Resolvers&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;Addr&#34;</span>:<span style="color:#e6db74">&#34;1.1.1.1&#34;</span><span style="color:#f92672">}]}</span>
User created
<span style="color:#f92672">[</span>root@racknerd-6d4dab3 ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec headscale headscale nodes register --user admin --key mkey:2342342344444444444444fb3ce635336028bc8989fa9615e233343434</span>
2024-04-08T12:28:14Z TRC DNS configuration loaded dns_config<span style="color:#f92672">={</span><span style="color:#e6db74">&#34;Nameservers&#34;</span>:<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;1.1.1.1&#34;</span><span style="color:#f92672">]</span>,<span style="color:#e6db74">&#34;Proxied&#34;</span>:true,<span style="color:#e6db74">&#34;Resolvers&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;Addr&#34;</span>:<span style="color:#e6db74">&#34;1.1.1.1&#34;</span><span style="color:#f92672">}]}</span>
Node desktop-mms156b registered
</code></pre></div><blockquote>
<p>接下来就看到以下成功信息<br>
<img src="img_1.png" alt="img_1.png"></p>
</blockquote>
<blockquote>
<p>tailscale 客户端自动显示当前状态<br>
<img src="img_3.png" alt="img_3.png"></p>
</blockquote>
<blockquote>
<p>接下来就可以远程登录我的win10了，我要从100.64.0.2 的机器远程登录100.64.0.7的机器  <br>
<img src="img_4.png" alt="img_4.png"></p>
</blockquote>
<blockquote>
<p>远程登录win10 速度很赞，几乎和本地一样操作流畅，而且无需科学<br>
<img src="img_5.png" alt="img_5.png"></p>
</blockquote>

      </div></div>

  

  


<script src="https://utteranc.es/client.js"
        repo="ltanme/ltanme.github.io"
        issue-term="pathname"
        theme="github-dark-orange"
        crossorigin="anonymous"
        async>
</script>

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://ltan.me/assets/main.js"></script>
<script src="https://ltan.me/assets/prism.js"></script>







<script async src="https://www.googletagmanager.com/gtag/js?id=G-M6YN54PT6M"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-M6YN54PT6M');
</script>

  
</div>

</body>
</html>
